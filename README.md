# PARCO - Distributed Sparse Matrix-Vector Multiplication (MPI)
Author: Paolo Sarcletti
Course: Parallel Computing 2025/2026
University: University of Trento

## Project Overview
This project implements a distributed Sparse Matrix-Vector Multiplication (SpMV) using MPI and provides PBS scripts to run strong-scaling and weak-scaling experiments on an HPC cluster.

The workflow is designed to be reproducible: input data is either (1) downloaded manually (strong scaling) or (2) generated deterministically (weak scaling), and all outputs are saved as CSV in `results/`.

## Repository Structure
- src/
  - spmv.cpp        (MPI SpMV implementation)
  - make_mtx.cpp    (synthetic MatrixMarket generator)
- scripts/
  - strong_scaling.pbs
  - weak_scaling.pbs
  - make_mtx.pbs
- results/          (CSV outputs, tracked in git)
- matrix/           (input matrices, NOT tracked in git)
  - syn/            (synthetic matrices for weak scaling, NOT tracked in git)
- logs/             (PBS stdout/stderr, optional; depending on PBS directives)
- build/            (compiled binaries, optional; depending on scripts)

## Requirements
- PBS scheduler
- GCC toolchain
- MPI implementation (e.g., MPICH)

The PBS scripts load the required modules on the UniTN HPC cluster.

## Input Data (Matrices)

### Strong scaling matrices (real-world)
Strong scaling requires real sparse matrices in MatrixMarket format (.mtx). Place them in:
- matrix/

These files can be large and are intentionally NOT tracked by git (see `.gitignore`).

Required filenames (must exist in `matrix/` before running strong scaling):
- cavity07.mtx
- msc10848.mtx
- x104.mtx
- nlpkkt80.mtx
- Flan_1565.mtx

How to obtain them:
- Download the matrices from the SuiteSparse Matrix Collection (manual search by name).
- The website typically provides .tar.gz archives that contain the .mtx file.
- After extraction, copy the .mtx file into `matrix/` using the expected filename above.

Example extraction workflow (generic):
cd ~/repo
mkdir -p matrix
cd matrix
# download <NAME>.tar.gz from SuiteSparse, then:
gzip -d <NAME>.tar.gz
tar -xf <NAME>.tar
# locate the .mtx inside the extracted folder and copy/move it into matrix/
cd ..

### Weak scaling matrices (synthetic)
Weak scaling uses synthetic matrices generated by `src/make_mtx.cpp` and written to:
- matrix/syn/

Naming convention:
- <SERIES>_p<P>.mtx
Example: w100k_p1.mtx, w100k_p2.mtx, ..., w100k_p128.mtx

The generator uses a fixed internal seed, so matrix generation is deterministic.

## Execution (run from repository root)
Always submit jobs from the repository root:
cd ~/repo

### 1) Generate synthetic matrices (weak scaling inputs)
This step generates matrices in `matrix/syn/`.

qsub -v RC=1000,NNZ_ROW=100,SERIES=w100k  scripts/make_mtx.pbs && \
qsub -v RC=1000,NNZ_ROW=500,SERIES=w500k scripts/make_mtx.pbs && \
qsub -v RC=1000,NNZ_ROW=1000,SERIES=w1m  scripts/make_mtx.pbs

Parameters:
- RC: base size multiplier (matrix size is N = RC * p, square matrix)
- NNZ_ROW: number of non-zeros per row (K)
- SERIES: prefix for generated files (e.g., w100k)

Outputs:
- matrix/syn/<SERIES>_p<P>.mtx

### 2) Strong scaling runs
Run one PBS job per matrix (matrices must already be in `matrix/`).

qsub -v MTX=cavity07.mtx   scripts/strong_scaling.pbs && \
qsub -v MTX=msc10848.mtx   scripts/strong_scaling.pbs && \
qsub -v MTX=x104.mtx       scripts/strong_scaling.pbs && \
qsub -v MTX=nlpkkt80.mtx   scripts/strong_scaling.pbs && \
qsub -v MTX=Flan_1565.mtx  scripts/strong_scaling.pbs

Outputs (CSV):
- results/<matrix_name>_strong.csv

### 3) Weak scaling runs
Run one PBS job per synthetic series (matrices must already be present in `matrix/syn/`).

qsub -v SERIES=w100k  scripts/weak_scaling.pbs && \
qsub -v SERIES=w1m    scripts/weak_scaling.pbs && \
qsub -v SERIES=w500k  scripts/weak_scaling.pbs

Outputs (CSV):
- results/<SERIES>_weak.csv

## Results
All experiment outputs are stored as CSV under:
- results/

Examples:
- results/cavity07_strong.csv
- results/w100k_weak.csv

## Logs
PBS stdout/stderr files (.out/.err) are produced at submission time according to the `#PBS -o` / `#PBS -e` directives inside each script in `scripts/`.
Depending on the current configuration, they may appear in the repository root or under a dedicated folder such as `logs/`.

## Git notes
- CSV results under `results/` are tracked (included in the repository).
- MatrixMarket input files (.mtx) under `matrix/` and `matrix/syn/` are not tracked (large inputs).
- PBS logs and binaries can be excluded via `.gitignore`.

